$commitTimestamp = [DateTimeOffset]::Parse($env:APPVEYOR_REPO_COMMIT_TIMESTAMP)
$pkgVersion = $env:package_version
$asmVersion = $env:assembly_version + '.0'
$fileVersion = "$env:assembly_version.$env:APPVEYOR_BUILD_NUMBER"
$infoVersion = "Package=$env:package_version, Build=$env:APPVEYOR_BUILD_NUMBER, Branch=$env:APPVEYOR_REPO_BRANCH, Commit=$env:APPVEYOR_REPO_COMMIT"

"// Code generated by build/UpdateVersionInfo.ps1

internal static class ThisAssembly
{
    public const string Version = ""$asmVersion"";

    public const string FileVersion = ""$fileVersion"";

    public const string InformationalVersion = ""$infoVersion"";

    public const int BuildNumber = $env:APPVEYOR_BUILD_NUMBER;

    public const string Branch = ""$env:APPVEYOR_REPO_BRANCH"";

    public const string CommitId = ""$env:APPVEYOR_REPO_COMMIT"";

    public const string CommitTimestamp = ""$($commitTimestamp.ToString('s'))"";
}" > $PSScriptRoot/../src/Mio/ThisAssembly.Generated.cs

"<!-- Generated by build/UpdateVersionInfo.ps1 -->
<Project xmlns=""http://schemas.microsoft.com/developer/msbuild/2003"">
  <PropertyGroup>
    <Version>$pkgVersion</Version>
    <AssemblyVersion>$asmVersion</AssemblyVersion>
    <FileVersion>$fileVersion</FileVersion>
    <InformationalVersion>$infoVersion</InformationalVersion>
  </PropertyGroup>
</Project>" > $PSScriptRoot/../build/VersionInfo.Generated.props
